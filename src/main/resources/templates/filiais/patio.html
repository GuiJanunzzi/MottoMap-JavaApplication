<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/_header :: header}"></head>

<style>
    .patio-grid {
        display: grid;
        border: 2px solid #333;
    }
    .patio-cell {
        border: 1px solid #ccc;
        padding: 10px;
        text-align: center;
        min-height: 80px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    .ocupado {
        background-color: #f8d7da; /* Vermelho claro */
        font-weight: bold;
    }
    .vazio {
        background-color: #d1e7dd; /* Verde claro */
        color: #555;
    }
</style>

<body>

<nav th:replace="~{fragments/_header :: navbar}"></nav>

<div class="container mt-4">
    <h1>Mapa do Pátio: <span th:text="${filial.nome}"></span></h1>
    <p>Visão geral das posições e motos no pátio.</p>
    <hr>

    <div class="patio-grid" th:style="'grid-template-columns: repeat(' + ${filial.numeroColuna} + ', 1fr);'">
        <div th:each="linha : ${#numbers.sequence(1, filial.numeroLinha)}">
            <div th:each="coluna : ${#numbers.sequence(1, filial.numeroColuna)}">

                <div th:with="posicao=${gradePatio.get(linha)?.get(coluna)}">

                    <th:block th:if="${posicao != null}">

                        <th:block th:if="${posicao.moto != null}">
                            <a th:href="@{/motos/{id}(id=${posicao.moto.id})}"
                               class="patio-cell ocupado text-decoration-none text-dark"
                               th:title="${posicao.moto.modeloMoto + ' - ' + posicao.moto.ano}">
                                <span th:text="${posicao.moto.placa}"></span>
                                <small th:text="${posicao.identificacao}"></small>
                            </a>
                        </th:block>

                        <th:block th:if="${posicao.moto == null}">
                            <a th:href="@{/posicoes/{id}/ocupar(id=${posicao.id})}"
                               class="patio-cell vazio text-decoration-none text-dark">
                                <span th:text="${posicao.identificacao}"></span>
                                <small>Vazio</small>
                            </a>
                        </th:block>

                    </th:block>

                    <div th:if="${posicao == null}" class="patio-cell"></div>
                </div>
            </div>
        </div>
    </div>

    <a th:href="@{/filiais}" class="btn btn-secondary mt-4">Voltar para a Lista de Filiais</a>
</div>

<footer th:replace="~{fragments/_footer :: footer}"></footer>
</body>
</html>